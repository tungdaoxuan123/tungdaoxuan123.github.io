<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Live Trading Dashboard</title>
  <!-- Chart.js for price charts -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #292F36 0%, #1a1e26 100%);
      color: #8F7A6E;
      padding: 20px;
      min-height: 100vh;
    }
    
    .container {
      max-width: 1400px;
      margin: auto;
    }
    
    header {
      text-align: center;
      margin-bottom: 40px;
    }
    
    h1 {
      color: #A41F13;
      font-size: 2.5em;
      margin-bottom: 10px;
      text-shadow: 0 0 20px #A41F1344;
    }
    
    .subtitle {
      color: #8F7A6E;
      font-size: 1.1em;
    }
    
    .controls {
      text-align: center;
      margin-bottom: 30px;
    }
    
    .refresh-btn {
      padding: 12px 30px;
      background: #A41F13;
      color: #FAF5F1;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
      margin: 0 10px;
    }
    
    .refresh-btn:hover {
      background: #8a1a0f;
      transform: scale(1.05);
    }
    
    .refresh-btn:active {
      transform: scale(0.95);
    }
    
    .assets-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
      gap: 25px;
      margin-bottom: 40px;
    }
    
    .asset-card {
      background: #E0DBD8;
      border: 3px solid #A41F13;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 8px 32px rgba(164, 31, 19, 0.15);
      transition: all 0.3s ease;
    }
    
    .asset-card:hover {
      border-color: #A41F13;
      box-shadow: 0 8px 32px rgba(164, 31, 19, 0.3);
      transform: translateY(-5px);
      background: #FAF5F1;
    }
    
    .asset-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
      border-bottom: 3px solid #A41F13;
      padding-bottom: 10px;
    }
    
    .asset-name {
      font-size: 1.8em;
      font-weight: bold;
      color: #A41F13;
    }
    
    .asset-name-small {
      font-size: 0.8em;
      color: #8F7A6E;
      font-weight: normal;
    }
    
    .asset-info {
      display: flex;
      justify-content: space-between;
      margin-bottom: 15px;
      flex-wrap: wrap;
    }
    
    .info-box {
      flex: 1;
      min-width: 100px;
    }
    
    .info-label {
      font-size: 0.9em;
      color: #8F7A6E;
      text-transform: uppercase;
      letter-spacing: 1px;
      font-weight: 600;
    }
    
    .info-value {
      font-size: 1.4em;
      font-weight: bold;
      color: #292F36;
      margin-top: 5px;
    }
    
    .price-change.positive {
      color: #A41F13;
    }
    
    .price-change.negative {
      color: #8F7A6E;
    }
    
    .chart-container {
      position: relative;
      height: 200px;
      margin-bottom: 15px;
      background: #FAF5F1;
      border-radius: 8px;
      padding: 10px;
      border: 2px solid #E0DBD8;
    }
    
    .status {
      text-align: center;
      padding: 20px;
      background: #E0DBD8;
      border-radius: 8px;
      color: #8F7A6E;
      margin-top: 20px;
      border: 2px solid #A41F13;
    }
    
    .status.loading {
      color: #A41F13;
    }
    
    .status.error {
      color: #A41F13;
    }
    
    .timestamp {
      font-size: 0.9em;
      color: #8F7A6E;
      margin-top: 10px;
      text-align: center;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>üìä Live Trading Dashboard</h1>
      <p class="subtitle">Real-time price tracking for BTC, ETH, SOL, GOOGL, TSLA, AMZN</p>
    </header>
    
    <div class="controls">
      <button class="refresh-btn" onclick="fetchAllData()">üîÑ Refresh Data</button>
      <button class="refresh-btn" onclick="toggleAutoRefresh()">‚è±Ô∏è Auto Refresh: <span id="auto-status">OFF</span></button>
    </div>
    
    <div id="status" class="status loading">Loading price data...</div>
    
    <div id="assets-container" class="assets-grid"></div>
    
    <div class="timestamp">
      Last updated: <span id="last-update">Never</span>
    </div>
  </div>

  <script>
    // Asset configurations
    const ASSETS = [
      { symbol: 'BTC', name: 'Bitcoin', type: 'crypto', color: '#A41F13' },
      { symbol: 'ETH', name: 'Ethereum', type: 'crypto', color: '#292F36' },
      { symbol: 'SOL', name: 'Solana', type: 'crypto', color: '#8F7A6E' },
      { symbol: 'GOOGL', name: 'Google', type: 'stock', color: '#A41F13' },
      { symbol: 'TSLA', name: 'Tesla', type: 'stock', color: '#292F36' },
      { symbol: 'AMZN', name: 'Amazon', type: 'stock', color: '#8F7A6E' }
    ];

    let autoRefreshInterval = null;
    let assetCharts = {};

    // Fetch price data from CoinGecko (free, no auth required)
    async function fetchPriceData(symbol, type) {
      try {
        let url;
        if (type === 'crypto') {
          const cryptoMap = {
            'BTC': 'bitcoin',
            'ETH': 'ethereum',
            'SOL': 'solana'
          };
          const cryptoId = cryptoMap[symbol];
          url = `https://api.coingecko.com/api/v3/simple/price?ids=${cryptoId}&vs_currencies=usd&include_market_cap=true&include_24hr_vol=true&include_24hr_change=true`;
          
          const response = await fetch(url);
          const data = await response.json();
          const cryptoData = data[cryptoId];
          
          return {
            price: cryptoData.usd,
            change24h: cryptoData.usd_24h_change,
            marketCap: cryptoData.usd_market_cap,
            volume24h: cryptoData.usd_24h_vol
          };
        } else {
          // Yahoo Finance API alternative (no key required)
          const yfinanceUrl = `https://query1.finance.yahoo.com/v10/finance/quoteSummary/${symbol}?modules=price`;
          
          const response = await fetch(yfinanceUrl);
          const data = await response.json();
          const quoteData = data.quoteSummary.result[0].price;
          
          return {
            price: quoteData.regularMarketPrice.raw,
            change24h: quoteData.regularMarketChangePercent.raw,
            marketCap: 'N/A',
            volume24h: quoteData.regularMarketVolume.raw
          };
        }
      } catch (error) {
        console.error(`Error fetching ${symbol}:`, error);
        return null;
      }
    }

    // Fetch historical data for charts
    async function fetchHistoricalData(symbol, type) {
      try {
        if (type === 'crypto') {
          const cryptoMap = {
            'BTC': 'bitcoin',
            'ETH': 'ethereum',
            'SOL': 'solana'
          };
          const cryptoId = cryptoMap[symbol];
          const url = `https://api.coingecko.com/api/v3/coins/${cryptoId}/market_chart?vs_currency=usd&days=7`;
          
          const response = await fetch(url);
          const data = await response.json();
          return data.prices.map(p => ({ time: p[0], price: p[1] }));
        } else {
          return generateMockStockData(symbol);
        }
      } catch (error) {
        console.error(`Error fetching historical data for ${symbol}:`, error);
        return [];
      }
    }

    // Generate mock stock data
    function generateMockStockData(symbol) {
      const data = [];
      const now = Date.now();
      let price = 100 + Math.random() * 400;

      for (let i = 168; i > 0; i--) {
        const change = (Math.random() - 0.5) * 10;
        price = Math.max(price + change, 50);
        data.push({
          time: now - i * 3600000,
          price: price
        });
      }
      return data;
    }

    // Create or update chart
    function createChart(symbol, historicalData, color) {
      const ctx = document.getElementById(`chart-${symbol}`);
      if (!ctx) return;

      const labels = historicalData.map(d => new Date(d.time).toLocaleDateString());
      const prices = historicalData.map(d => d.price);

      if (assetCharts[symbol]) {
        assetCharts[symbol].destroy();
      }

      const chart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: labels,
          datasets: [{
            label: `${symbol} Price`,
            data: prices,
            borderColor: color,
            backgroundColor: color + '15',
            borderWidth: 3,
            fill: true,
            tension: 0.4,
            pointRadius: 0,
            pointHoverRadius: 6,
            pointBackgroundColor: color
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              display: false
            }
          },
          scales: {
            y: {
              beginAtZero: false,
              ticks: {
                color: '#8F7A6E'
              },
              grid: {
                color: '#E0DBD8'
              }
            },
            x: {
              ticks: {
                color: '#8F7A6E',
                maxTicksLimit: 4
              },
              grid: {
                color: '#E0DBD8'
              }
            }
          }
        }
      });

      assetCharts[symbol] = chart;
    }

    // Render asset card
    function renderAssetCard(asset, data) {
      const container = document.getElementById('assets-container');
      const changeClass = data && data.change24h >= 0 ? 'positive' : 'negative';
      const changeSymbol = data && data.change24h >= 0 ? 'üìà' : 'üìâ';
      const price = data ? `$${data.price.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}` : 'Loading...';
      const change = data ? `${changeSymbol} ${data.change24h.toFixed(2)}%` : 'N/A';

      let cardHTML = `
        <div class="asset-card">
          <div class="asset-header">
            <div>
              <div class="asset-name">${asset.symbol}</div>
              <div class="asset-name-small">${asset.name}</div>
            </div>
          </div>
          <div class="asset-info">
            <div class="info-box">
              <div class="info-label">Price</div>
              <div class="info-value">${price}</div>
            </div>
            <div class="info-box">
              <div class="info-label">24h Change</div>
              <div class="info-value price-change ${changeClass}">${change}</div>
            </div>
          </div>
          <div class="chart-container">
            <canvas id="chart-${asset.symbol}"></canvas>
          </div>
          <div class="info-label" style="color: #8F7A6E; font-size: 0.8em;">7-day price chart</div>
        </div>
      `;

      const existing = container.querySelector(`[data-symbol="${asset.symbol}"]`);
      const card = document.createElement('div');
      card.setAttribute('data-symbol', asset.symbol);
      card.innerHTML = cardHTML;

      if (existing) {
        existing.replaceWith(card);
      } else {
        container.appendChild(card);
      }
    }

    // Fetch all data and render
    async function fetchAllData() {
      const statusEl = document.getElementById('status');
      statusEl.textContent = '‚è≥ Loading price data...';
      statusEl.className = 'status loading';

      try {
        for (const asset of ASSETS) {
          const data = await fetchPriceData(asset.symbol, asset.type);
          renderAssetCard(asset, data);

          if (data) {
            const historicalData = await fetchHistoricalData(asset.symbol, asset.type);
            if (historicalData.length > 0) {
              setTimeout(() => createChart(asset.symbol, historicalData, asset.color), 100);
            }
          }

          await new Promise(resolve => setTimeout(resolve, 500));
        }

        statusEl.textContent = '‚úÖ Data loaded successfully';
        statusEl.className = 'status';
        document.getElementById('last-update').textContent = new Date().toLocaleTimeString();
      } catch (error) {
        statusEl.textContent = '‚ùå Error loading data: ' + error.message;
        statusEl.className = 'status error';
      }
    }

    // Auto-refresh toggle
    function toggleAutoRefresh() {
      const autoStatusEl = document.getElementById('auto-status');
      if (autoRefreshInterval) {
        clearInterval(autoRefreshInterval);
        autoRefreshInterval = null;
        autoStatusEl.textContent = 'OFF';
      } else {
        fetchAllData();
        autoRefreshInterval = setInterval(fetchAllData, 60000);
        autoStatusEl.textContent = 'ON';
      }
    }

    // Initial load
    fetchAllData();
  </script>
</body>
</html>
